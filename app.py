# (ê¸°ì¡´ ë°ì´í„° ë¶„ì„ ë¡œì§ ì´í›„ì— ì¶”ê°€)

        # 4. ì €íš¨ìœ¨ í‚¤ì›Œë“œ ì¶”ì¶œ (ê´‘ê³ ë¹„ > 0 ì´ê³  íŒë§¤ìˆ˜ëŸ‰ == 0ì¸ ë°ì´í„°)
        st.divider()
        st.subheader("âœ‚ï¸ ê´‘ê³ ë¹„ ë„ë‘‘ í‚¤ì›Œë“œ (ì œì™¸ ëŒ€ìƒ ì œì•ˆ)")
        
        # ì›ë³¸ ë°ì´í„°(df)ì—ì„œ í‚¤ì›Œë“œë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ë¶„ì„
        # ì¿ íŒ¡ ë³´ê³ ì„œ ì»¬ëŸ¼ëª… ê¸°ì¤€: 'í‚¤ì›Œë“œ'
        if 'í‚¤ì›Œë“œ' in df.columns:
            kw_analysis = df.groupby('í‚¤ì›Œë“œ').agg({
                'ê´‘ê³ ë¹„': 'sum',
                col_qty: 'sum'
            }).reset_index()
            
            # í•„í„°ë§: ê´‘ê³ ë¹„ëŠ” ì¼ëŠ”ë° íŒë§¤ìˆ˜ëŸ‰ì€ 0ì¸ í‚¤ì›Œë“œ
            bad_keywords_df = kw_analysis[
                (kw_analysis['ê´‘ê³ ë¹„'] > 0) & (kw_analysis[col_qty] == 0)
            ].sort_values(by='ê´‘ê³ ë¹„', ascending=False)

            if not bad_keywords_df.empty:
                st.write(f"í˜„ì¬ ì´ **{len(bad_keywords_df)}ê°œ**ì˜ í‚¤ì›Œë“œê°€ ë§¤ì¶œ ì—†ì´ ê´‘ê³ ë¹„ë§Œ ì†Œì§„í•˜ê³  ìˆìŠµë‹ˆë‹¤.")
                
                # í…ìŠ¤íŠ¸ ë³µì‚¬ ê¸°ëŠ¥ (ì½”ë“œ ë¸”ë¡ í˜•íƒœë‚˜ text_area í™œìš©)
                bad_kw_list = ", ".join(bad_keywords_df['í‚¤ì›Œë“œ'].tolist())
                st.text_area("ğŸ“‹ ì•„ë˜ í‚¤ì›Œë“œë¥¼ ë³µì‚¬í•˜ì—¬ 'ì œì™¸ í‚¤ì›Œë“œ'ì— ë“±ë¡í•˜ì„¸ìš”:", value=bad_kw_list, height=100)
                
                # ìƒì„¸ í‘œ ë…¸ì¶œ
                st.dataframe(bad_keywords_df.style.format({
                    'ê´‘ê³ ë¹„': '{:,.0f}ì›',
                    col_qty: '{:,.0f}ê°œ'
                }), use_container_width=True)
            else:
                st.success("ğŸ‰ ëª¨ë“  í‚¤ì›Œë“œê°€ ì œ ì—­í• ì„ í•˜ê³  ìˆê±°ë‚˜ ê´‘ê³ ë¹„ê°€ ì§‘í–‰ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤!")
        else:
            st.warning("âš ï¸ ë³´ê³ ì„œì— 'í‚¤ì›Œë“œ' ì»¬ëŸ¼ì´ ì—†ì–´ í‚¤ì›Œë“œë³„ ë¶„ì„ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. (ì§€ë©´ ë³´ê³ ì„œê°€ ì•„ë‹Œ í‚¤ì›Œë“œ ë³´ê³ ì„œë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”)")